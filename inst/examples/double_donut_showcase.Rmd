---
title: "Double Donut Nodes Showcase"
author: "Sonnet Package"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 10, fig.height = 10, dpi = 150)
library(Sonnet)
set.seed(42)
```

## Overview

This document showcases the new double donut node features in Sonnet:

1. **Double Donut Rings** - Two concentric donut rings with optional inner pie
2. **Separate Border Thickness** - Independent control of pie vs node borders
3. **node_fill Fallback** - Uses node_fill as default color for pies/donuts

## Create a 10-Node Network

```{r network}
# Create a 10-node directed network
n <- 10
mat <- matrix(0, n, n)

# Add structured edges
edges <- list(
  c(1, 2), c(1, 3), c(2, 4), c(2, 5), c(3, 5), c(3, 6),

c(4, 7), c(5, 7), c(5, 8), c(6, 8), c(6, 9),
  c(7, 10), c(8, 10), c(9, 10), c(4, 5), c(7, 8)
)

for (e in edges) {
  mat[e[1], e[2]] <- runif(1, 0.5, 1)
}

# Node labels
rownames(mat) <- colnames(mat) <- LETTERS[1:n]
```

## Example 1: Full Double Donut + Pie

Three concentric layers showing different metrics:

- **Outer ring**: Primary metric (e.g., completion rate)
- **Inner ring**: Secondary metric (e.g., confidence)
- **Center pie**: Category breakdown

```{r double_donut_pie, fig.height=10}
splot(mat,
  layout = "circle",
  directed = TRUE,

  # Outer donut: segmented by 3 categories
  donut_values = lapply(1:n, function(i) c(runif(1), runif(1), runif(1))),
  donut_colors = list(c("#E63946", "#457B9D", "#2A9D8F")),

  # Inner donut: progress indicator (single value 0-1)
  donut2_values = as.list(runif(n, 0.4, 0.95)),
  donut2_colors = list("#F4A261"),

  # Center pie: detailed breakdown
  pie_values = lapply(1:n, function(i) sample(1:5, 4)),
  pie_colors = list(c("#264653", "#E9C46A", "#F4A261", "#E76F51")),

  # Layer ratios
  donut_inner_ratio = 0.7,
  donut2_inner_ratio = 0.45,
  donut_bg_color = "gray95",

  # Separate border widths
  pie_border_width = 0.3,
  donut_border_width = 0.8,
  node_border_width = 1.5,
  node_border_color = "gray30",

  # Node sizing
  node_size = 6,

  # Edge styling
  arrow_size = 1.2,
  edge_width = 1.5,
  positive_color = "#2A9D8F",

  # Labels
  labels = TRUE,
  label_size = 0.8,

  title = "Double Donut + Pie: Multi-Layer Dashboard"
)
```

## Example 2: Segmented Double Donuts (No Pie)

Two categorical breakdown rings with white center:

```{r segmented_donuts, fig.height=10}
splot(mat,
  layout = "spring",
  directed = TRUE,

  # Outer donut: 4 categories
  donut_values = lapply(1:n, function(i) c(3, 2, 2, 1) + runif(4, -0.5, 0.5)),
  donut_colors = list(c("#003049", "#D62828", "#F77F00", "#FCBF49")),

  # Inner donut: 3 categories
  donut2_values = lapply(1:n, function(i) c(2, 3, 1) + runif(3, -0.3, 0.3)),
  donut2_colors = list(c("#606C38", "#283618", "#DDA15E")),

  donut_inner_ratio = 0.65,
  donut2_inner_ratio = 0.35,
  donut_bg_color = "white",

  donut_border_width = 0.6,
  node_border_width = 1.2,
  node_border_color = "gray40",

  node_size = 5,
  arrow_size = 1,
  edge_width = 1.2,

  title = "Segmented Double Donuts: Categorical Layers"
)
```

## Example 3: Progress Rings with Pie Detail

Both donut rings as progress indicators (0-1 values):

```{r progress_rings, fig.height=10}
# Create meaningful progress data
outer_progress <- seq(0.3, 0.95, length.out = n)  # Increasing completion
inner_progress <- rev(seq(0.4, 0.9, length.out = n))  # Decreasing metric

splot(mat,
  layout = "circle",
  directed = TRUE,

  # Outer ring: primary progress (0-1)
  donut_values = as.list(outer_progress),
  donut_colors = list("#1D3557"),

  # Inner ring: secondary progress (0-1)
  donut2_values = as.list(inner_progress),
  donut2_colors = list("#E63946"),

  # Center pie: category distribution
  pie_values = lapply(1:n, function(i) c(3, 2, 1)),
  pie_colors = list(c("#A8DADC", "#457B9D", "#1D3557")),

  donut_inner_ratio = 0.7,
  donut2_inner_ratio = 0.45,
  donut_bg_color = "gray90",

  pie_border_width = 0.2,
  donut_border_width = 1,
  node_border_width = 1.5,

  node_size = 6,
  arrow_size = 1.2,

  title = "Progress Rings: Outer=Completion, Inner=Confidence"
)
```

## Example 4: node_fill Fallback Demo

When no colors are specified, `node_fill` becomes the default:

```{r node_fill_fallback, fig.height=10}
# Custom node colors
node_colors <- c("#264653", "#2A9D8F", "#E9C46A", "#F4A261", "#E76F51",
                 "#D62828", "#003049", "#FCBF49", "#606C38", "#BC6C25")

splot(mat,
  layout = "spring",
  directed = TRUE,

  # Donut with no colors specified - uses node_fill
  donut_values = as.list(runif(n, 0.5, 0.9)),
  # donut_colors not specified!

  # Pie with single segment - uses node_fill
  pie_values = lapply(1:n, function(i) c(1)),
  # pie_colors not specified!

  node_fill = node_colors,  # This becomes the fallback color

  donut_inner_ratio = 0.6,
  donut_bg_color = "gray95",

  donut_border_width = 1,
  node_border_width = 2,
  node_border_color = "gray30",

  node_size = 5,
  arrow_size = 1,

  title = "node_fill Fallback: Colors Inherited from node_fill"
)
```

## Example 5: Mixed Node Types

Different nodes with different visualization styles:

```{r mixed_types, fig.height=10}
# Only some nodes have outer donuts
outer_donuts <- vector("list", n)
outer_donuts[[1]] <- c(0.3, 0.4, 0.3)
outer_donuts[[3]] <- c(0.5, 0.5)
outer_donuts[[5]] <- 0.75
outer_donuts[[7]] <- c(0.2, 0.3, 0.5)
outer_donuts[[9]] <- 0.6

# Only some nodes have inner donuts
inner_donuts <- vector("list", n)
inner_donuts[[1]] <- 0.8
inner_donuts[[3]] <- 0.65
inner_donuts[[5]] <- c(0.4, 0.6)
inner_donuts[[7]] <- 0.55

# Only some nodes have pies
pies <- vector("list", n)
pies[[2]] <- c(1, 2, 1)
pies[[4]] <- c(3, 2)
pies[[6]] <- c(1, 1, 1, 1)
pies[[8]] <- c(2, 3, 1)
pies[[10]] <- c(1, 2)

splot(mat,
  layout = "circle",
  directed = TRUE,

  donut_values = outer_donuts,
  donut_colors = list(c("#E63946", "#457B9D", "#2A9D8F")),

  donut2_values = inner_donuts,
  donut2_colors = list("#F4A261"),

  pie_values = pies,
  pie_colors = list(c("#264653", "#E9C46A", "#F4A261", "#E76F51")),

  node_fill = rep(c("#A8DADC", "#F1FAEE"), 5),

  donut_inner_ratio = 0.65,
  donut2_inner_ratio = 0.4,

  pie_border_width = 0.3,
  donut_border_width = 0.8,
  node_border_width = 1.2,

  node_size = 5,
  arrow_size = 1,

  title = "Mixed Node Types: Donuts, Pies, and Plain Nodes"
)
```

## Example 6: Varying Node Sizes

Node sizes scaled by importance with consistent donut proportions:

```{r varying_sizes, fig.height=10}
# Node sizes based on out-degree
out_degree <- rowSums(mat > 0)
node_sizes <- 3 + out_degree * 1.2

splot(mat,
  layout = "spring",
  directed = TRUE,

  donut_values = lapply(1:n, function(i) c(1, 2, 1)),
  donut_colors = list(c("#023047", "#219EBC", "#8ECAE6")),

  donut2_values = as.list(runif(n, 0.5, 0.9)),
  donut2_colors = list("#FFB703"),

  pie_values = lapply(1:n, function(i) c(2, 1)),
  pie_colors = list(c("#FB8500", "#023047")),

  donut_inner_ratio = 0.7,
  donut2_inner_ratio = 0.45,

  node_size = node_sizes,

  donut_border_width = 0.6,
  node_border_width = 1,

  arrow_size = 1,
  edge_width = 1.5,

  title = "Varying Sizes: Nodes Scaled by Out-Degree"
)
```

## Example 7: Dark Theme

Double donuts work well with dark backgrounds:

```{r dark_theme, fig.height=10}
splot(mat,
  layout = "circle",
  directed = TRUE,

  donut_values = lapply(1:n, function(i) c(runif(1), runif(1))),
  donut_colors = list(c("#F72585", "#7209B7")),

  donut2_values = as.list(runif(n, 0.4, 0.9)),
  donut2_colors = list("#4CC9F0"),

  pie_values = lapply(1:n, function(i) c(1, 2, 1)),
  pie_colors = list(c("#4361EE", "#3A0CA3", "#560BAD")),

  donut_inner_ratio = 0.68,
  donut2_inner_ratio = 0.42,
  donut_bg_color = "#2B2D42",

  node_border_color = "#EDF2F4",
  node_border_width = 1,
  donut_border_width = 0.5,
  pie_border_width = 0.2,

  node_size = 5.5,

  background = "#1A1A2E",
  positive_color = "#4CC9F0",
  arrow_size = 1.2,
  edge_width = 1.5,
  edge_alpha = 0.8,

  label_color = "white",

  title = "Dark Theme: Neon Double Donuts"
)
```

## Summary

The double donut feature enables rich multi-dimensional node visualizations:

| Layer | Purpose | Parameters |
|-------|---------|------------|
| Outer Donut | Primary metric/categories | `donut_values`, `donut_colors` |
| Inner Donut | Secondary metric/categories | `donut2_values`, `donut2_colors` |
| Center Pie | Detailed breakdown | `pie_values`, `pie_colors` |

Key parameters:

- `donut_inner_ratio`: Where outer donut ends (default 0.7)
- `donut2_inner_ratio`: Where inner donut ends (default 0.4)
- `pie_border_width`: Border for pie slice dividers
- `donut_border_width`: Border for donut ring circles
- `node_border_width`: Outer node border
